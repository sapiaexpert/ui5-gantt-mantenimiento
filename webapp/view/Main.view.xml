<mvc:View
    controllerName="com.sap.gantt.maintenance.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:gantt="sap.gantt.simple"
    xmlns:axistime="sap.gantt.axistime"
    xmlns:table="sap.ui.table"
    xmlns:core="sap.ui.core"
    displayBlock="true"
    height="100%">
    
    <Page
        id="mainPage"
        title="Diagrama de Gantt - Órdenes de Mantenimiento"
        showNavButton="false">
        
        <content>
            <!-- Stats Cards -->
            <HBox class="sapUiSmallMargin">
                <VBox class="sapUiSmallMarginEnd">
                    <ObjectStatus
                        title="Total Órdenes"
                        text="{statsModel>/total}"
                        state="Information"/>
                </VBox>
                <VBox class="sapUiSmallMarginEnd">
                    <ObjectStatus
                        title="Filtradas"
                        text="{statsModel>/filtered}"
                        state="Success"/>
                </VBox>
                <VBox class="sapUiSmallMarginEnd">
                    <ObjectStatus
                        title="Última Carga"
                        text="{statsModel>/loaded}"
                        state="None"/>
                </VBox>
            </HBox>
            
            <!-- Filtro de Fechas -->
            <Toolbar class="sapUiSmallMargin">
                <Label text="Fecha Inicio entre:" design="Bold"/>
                <DatePicker
                    id="startDatePicker"
                    value="{filterModel>/startDate}"
                    displayFormat="dd/MM/yyyy"
                    width="150px"
                    class="sapUiTinyMarginBegin"/>
                <Label text="y" class="sapUiTinyMarginBegin"/>
                <DatePicker
                    id="endDatePicker"
                    value="{filterModel>/endDate}"
                    displayFormat="dd/MM/yyyy"
                    width="150px"
                    class="sapUiTinyMarginBegin"/>
                <Button
                    text="Filtrar"
                    press=".onFilterByDate"
                    type="Emphasized"
                    icon="sap-icon://filter"
                    class="sapUiTinyMarginBegin"/>
            </Toolbar>
            
            <!-- GANTT CHART VISUAL REAL -->
            <VBox class="sapUiSmallMargin">
                <Title text="Cronograma de Mantenimiento ({ganttModel>/tasks/length} tareas)" level="H2"/>
                
                <gantt:GanttChartWithTable
                    id="ganttChart"
                    height="600px"
                    width="100%"
                    rows="{ganttModel>/tasks}">
                    
                    <!-- Configuración del Timeline -->
                    <gantt:axisTimeStrategy>
                        <axistime:ProportionZoomStrategy
                            totalHorizon="{ganttModel>/totalHorizon}"
                            visibleHorizon="{ganttModel>/visibleHorizon}"
                            mouseWheelZoomType="FineGranular"
                            zoomControlType="SliderOnly"
                            initialZoomLevel="0"/>
                    </gantt:axisTimeStrategy>
                    
                    <!-- Tabla lateral con información -->
                    <gantt:table>
                        <table:Table
                            rows="{ganttModel>/tasks}"
                            selectionMode="Single"
                            width="400px"
                            fixedColumnCount="2"
                            visibleRowCountMode="Auto">
                            <table:columns>
                                <table:Column width="80px">
                                    <Label text="Orden"/>
                                    <table:template>
                                        <Text text="{ganttModel>id}" wrapping="false"/>
                                    </table:template>
                                </table:Column>
                                <table:Column width="200px">
                                    <Label text="Descripción"/>
                                    <table:template>
                                        <Text text="{ganttModel>title}" wrapping="false"/>
                                    </table:template>
                                </table:Column>
                                <table:Column width="60px">
                                    <Label text="Prior."/>
                                    <table:template>
                                        <ObjectStatus
                                            text="{ganttModel>priority}"
                                            state="{= ${ganttModel>priority} === '1' ? 'Error' : ${ganttModel>priority} === '2' ? 'Warning' : 'Success' }"/>
                                    </table:template>
                                </table:Column>
                            </table:columns>
                        </table:Table>
                    </gantt:table>
                    
                    <!-- Filas del Gantt con barras -->
                    <gantt:rows>
                        <gantt:BaseRow>
                            <gantt:shapes1>
                                <gantt:BaseRectangle
                                    shapeId="{ganttModel>id}"
                                    time="{ganttModel>start}"
                                    endTime="{ganttModel>end}"
                                    title="{ganttModel>title}"
                                    fill="{= ${ganttModel>priority} === '1' ? '#bb0000' : ${ganttModel>priority} === '2' ? '#ff9500' : '#5899da' }"
                                    selectable="true"
                                    showTitle="false"
                                    height="20"
                                    animationSettings="{
                                        enable: true
                                    }"/>
                            </gantt:shapes1>
                        </gantt:BaseRow>
                    </gantt:rows>
                    
                </gantt:GanttChartWithTable>
                
                <MessageStrip
                    text="🎨 Gráfico Gantt interactivo: Use scroll horizontal para navegar, rueda del mouse para zoom. Colores: Rojo=Prioridad 1, Naranja=Prioridad 2, Azul=Otras"
                    type="Information"
                    showIcon="true"
                    class="sapUiSmallMarginTop"/>
            </VBox>
            
            <!-- Orders Table -->
            <VBox class="sapUiSmallMargin">
                <Title text="Detalle de Órdenes ({ordersModel>/orders/length})" level="H3"/>
                <Table
                    id="ordersTable"
                    items="{ordersModel>/orders}"
                    growing="true"
                    growingThreshold="20">
                    <columns>
                        <Column width="8em"><Text text="ID"/></Column>
                        <Column width="10em"><Text text="Equipo"/></Column>
                        <Column minScreenWidth="Tablet" demandPopin="true"><Text text="Descripción"/></Column>
                        <Column minScreenWidth="Tablet" demandPopin="true" width="8em"><Text text="Prioridad"/></Column>
                        <Column minScreenWidth="Desktop" demandPopin="true" width="10em"><Text text="Inicio"/></Column>
                        <Column minScreenWidth="Desktop" demandPopin="true" width="10em"><Text text="Fin"/></Column>
                        <Column minScreenWidth="Desktop" demandPopin="true" width="8em"><Text text="Duración"/></Column>
                        <Column minScreenWidth="Desktop" demandPopin="true" width="10em"><Text text="Responsable"/></Column>
                        <Column minScreenWidth="Desktop" demandPopin="true"><Text text="Departamento"/></Column>
                    </columns>
                    <items>
                        <ColumnListItem>
                            <cells>
                                <ObjectIdentifier
                                    title="{ordersModel>MaintenanceOrder}"
                                    text="{ordersModel>MaintenanceOrderType}"/>
                                <Text text="{ordersModel>EquipmentName}"/>
                                <Text text="{ordersModel>MaintenanceOrderDesc}"/>
                                <ObjectStatus
                                    text="{ordersModel>MaintPriority}"
                                    state="{= ${ordersModel>MaintPriority} === '1' ? 'Error' : ${ordersModel>MaintPriority} === '2' ? 'Warning' : 'Success' }"/>
                                <Text text="{
                                    path: 'ordersModel>MaintOrdBasicStartDate',
                                    type: 'sap.ui.model.type.Date',
                                    formatOptions: { pattern: 'dd/MM/yyyy' }
                                }"/>
                                <Text text="{
                                    path: 'ordersModel>MaintOrdBasicEndDate',
                                    type: 'sap.ui.model.type.Date',
                                    formatOptions: { pattern: 'dd/MM/yyyy' }
                                }"/>
                                <Text text="-"/>
                                <Text text="{ordersModel>MaintOrdPersonResponsible}"/>
                                <Text text="{ordersModel>MaintenancePlant}"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </VBox>
        </content>
    </Page>
</mvc:View>
